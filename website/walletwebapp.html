<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dogecoin wallet app</title>
    <!-- AJAX -->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <!-- bootstrap5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
        crossorigin="anonymous"></script>
</head>

<body>
    <!-- Nav tabs -->
    <ul class="nav nav-tabs justify-content-center" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button"
                role="tab" aria-controls="home" aria-selected="true">Home</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button"
                role="tab" aria-controls="profile" aria-selected="false">My transactions</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="messages-tab" data-bs-toggle="tab" data-bs-target="#Transfer" type="button"
                role="tab" aria-controls="Transfer" aria-selected="false">Transfer</button>
        </li>
    </ul>

    <!-- Tab panes -->
    <div class="tab-content">
        <div class="tab-pane active text-center m-3 p-3" id="home" role="tabpanel" aria-labelledby="home-tab">
            <div class="m-4">
                <span id="balanceid">0</span>
                Dogecoin
            </div>
            <div class="d-flex justify-content-center">
                <div class="input-group flex-nowrap" style="width:60%">
                    <span class="input-group-text" id="addon-wrapping">Public address</span>
                    <input id="publicaddr" type="text" class="form-control" placeholder="address" aria-label="Username"
                        aria-describedby="addon-wrapping">
                </div>
            </div>
            <div class="d-flex justify-content-center">
                <div class="input-group mt-3 " style="width: 50%;">
                    <input id="your_key" type="text" class="form-control" placeholder="Your key"
                        aria-label="Recipient's username" aria-describedby="checkkey">
                    <button class="btn btn-outline-secondary" type="button" id="checkkey">Click</button>
                </div>
            </div>
            <br>
            <button class="btn btn-primary text-center mx-2" data-bs-toggle="modal" data-bs-target="#modelId">Create
                Dogecoin
                wallet</button>
            <button id="btn_open_modal_senddoge" class="btn btn-warning text-center mx-2" data-bs-toggle="modal"
                data-bs-target="#modalsend">
                Send Dogecoin</button>
        </div>
       
                    <div class="tab-pane" id="profile" role="tabpanel" aria-labelledby="profile-tab"
                        style="width: 100vw; overflow-y: hidden;">
                        <!-- <button onclick="profile_pending()">pending</button><button onclick="profile_success()">success</button><button onclick="profile_total()">total</button> -->
                        <table class="table table-striped mx-5">
                            <thead>
                                <tr>
                                    <td style="width: 30vw;">Transactions ID</td>
                                    <td>Catagories</td>
                                    <td>Amount</td>
                                    <td>Time</td>
                                    <td>Confirmations</td>
                                    <td>Status</td>
                                    <td></td>
                                </tr>
                            </thead>
                                <tbody id="tableProfile_total" class="table table-striped"></tbody>
                                <!-- <tbody id="tableProfile_success"  class="table table-striped"></tbody>
                <tbody id="tableProfile_pending"  class="table table-striped"></tbody> -->
                        </table>

                    </div>
                    <div class="tab-pane" id="Transfer" role="tabpanel" aria-labelledby="profile-tab"> transfer </div>
                    <!-- <div class="tab-pane" id="messages" role="tabpanel" aria-labelledby="messages-tab"> messages </div> -->
    </div>


    <!-- Modal -->
    <div class="modal fade" id="modelId" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">create wallet ?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    you want to create a new wallet !
                    <br>
                    get free 5 coin !!
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                    <Yes id="btncreate" type="button" class="btn btn-primary" data-bs-dismiss="modal">Yes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal send dogecoin -->
    <div class="modal fade" id="modalsend" tabindex="-1" role="dialog" aria-labelledby="modelTitleId"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Transfer ?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="input-group mb-3">
                        <span class="input-group-text" id="inputGroup-sizing-default">Send to </span>
                        <input id="toaddrtxt" type="text" class="form-control" aria-label="Sizing example input"
                            aria-describedby="inputGroup-sizing-default" placeholder="address">
                    </div>
                </div>
                <div class="modal-body">
                    <div class="input-group mb-3">
                        <span class="input-group-text" id="inputGroup-sizing-default">Amount </span>
                        <input id="amountid" type="text" class="form-control" aria-label="Sizing example input"
                            aria-describedby="inputGroup-sizing-default" placeholder="numbber">
                    </div>
                </div>
                <div id="txidmadal" class="modal-body d-none">
                    <div class="input-group mb-3">
                        <span class="input-group-text" id="inputGroup-sizing-default">TXID </span>
                        <input id="txid" type="text" class="form-control" aria-label="Sizing example input"
                            aria-describedby="inputGroup-sizing-default" placeholder="txid">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                    <Yes id="senddoge" type="button" class="btn btn-primary" data-bs-dismiss="">Yes</button>
                </div>
            </div>
        </div>
    </div>

</body>

</html>
<script>
    document.querySelector("#btn_open_modal_senddoge").addEventListener("click", function (e) {

    })
    document.querySelector("#senddoge").addEventListener("click", function (e) {
        let toaddr = document.getElementById("toaddrtxt").value
        let amount = document.getElementById("amountid").value
        let key = document.getElementById("your_key").value
        let txid = document.getElementById("txid")
        let txidmadal = document.getElementById("txidmadal")
        console.log(toaddr)
        fetch("http://167.99.71.116:3000/api/sendfrom/web", {
            method: "POST",
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({
                "keys": key,
                "address": toaddr,
                "amount": amount
            })
        }).then(res => res.json()).then(data => {
            if (data.msg == "success") {
                txid.value = data.txid;
                txidmadal.classList.remove("d-none")
                alert("send dogecoin success")
            }
            else {
                console.log(data)
            }
        }).catch(err => {
            alert(err.msg)
        })
    })

    document.querySelector("#btncreate").addEventListener("click", function (e) {
        fetch("http://167.99.71.116:3000/api/access/token/web", {
            method: "POST"
        }).then(function (response) {
            return response.json()
        }).then(data => {
            let token = data.token
            localStorage.setItem("token", token)
            document.querySelector("#your_key").value = localStorage.getItem("token")
            console.log(localStorage.getItem("token"));
            fetch("http://167.99.71.116:3000/api/post/createwallet/wab", {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({
                    token: localStorage.getItem("token")
                })
            }).then(res => res.json()).then(data => {
                console.log(data);
                alert(data.msg)
            }).catch(err => {
                console.log(err)
            })

        }).catch(err => alert(err))
    })
    document.querySelector("#checkkey").addEventListener("click", function (e) {
        let keys = document.querySelector("#your_key").value
        console.log(keys)
        if (keys.length == 32 || keys == "admin") {
            fetch("http://167.99.71.116:3000/get/publickey", {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({ "keys": keys })
            }).then((res) => { return res.json() }).then(data => {
                let publickey = data.publickey
                let balance = data.balance
                console.log(data)
                document.querySelector("#publicaddr").value = publickey
                document.querySelector("#balanceid").textContent = balance
                // alert(data)
            })
        } else {
            alert("Please input a key or your key incorrect")
        }
    });

    document.querySelector("#profile-tab").addEventListener("click", function (e) {

        let keys = document.querySelector("#your_key").value
        if(!!keys){
            fetch("http://167.99.71.116:3000/api/listtransactions/web", {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({ "keys": keys })
            }).then((res) => { return res.json() }).then(data => {
                // console.log(data);
                table = ``;
                success = ``;
                pending = ``;
                let txid = data.list;
                let txlenght = Object.keys(txid);
                let catagory;
                console.log(txid);
                for (let i = 0; i < txlenght.length; i++) {
                    catagory = txid[i].category;



                    // console.log("index :",i,"=>move =",(catagory.includes('move')))
                    if (catagory.includes('move')) {
                        continue;
                    }

                    var time = txid[i].timereceived;
                    time = time * 1000;
                    time = new Date(time);
                    console.log("after time===>", time);
                    time = time + "";
                    console.log("time :", time)
                    var split_time = time.split(" ")
                    var year = split_time[3].split("")
                    var newTime = split_time[1] + " " + split_time[2] + " " + year[2] + "" + year[3];
                    console.log("index :", i, "new time :", newTime)




                    if (txid[i].confirmations == 0) {
                        if (catagory.includes('send')) {
                            table += `
                            <tr>
                                <td style="width: 30vw; overflow-x: scroll;">${txid[i].txid}</td>
                                <td>${catagory}</td>
                                <td>${txid[i].amount} Ð</td>
                                <td>${newTime}</td>
                                <td>${txid[i].confirmations}</td>
                                <td><button class="${txid[i].confirmations > 0 ? 'btn btn-success' : 'btn btn-warning'}" style="background: ${txid[i].confirmations > 0 ? 'limegreen' : '#ffc107'};">${txid[i].confirmations > 0 ? 'success' : 'pending'}</button></td>
                                <td><a href="https://chain.so/tx/DOGETEST/${txid[i].txid}" target="_blank">more info</td>
                            </tr>
                        `;
                        } else if (catagory.includes("receive")) {
                            table += `
                            <tr>
                                <td style="width: 30vw; overflow-x: scroll;">${txid[i].txid}</td>
                                <td>${catagory}</td>
                                <td>${txid[i].amount} Ð</td>
                                <td>${newTime}</td>
                                <td>${txid[i].confirmations}</td>
                                <td><button class="${txid[i].confirmations > 0 ? 'btn btn-success' : 'btn btn-warning'}" style="background: ${txid[i].confirmations > 0 ? 'limegreen' : '#ffc107'};">${txid[i].confirmations > 0 ? 'success' : 'pending'}</button></td>
                                <td><a href="https://chain.so/tx/DOGETEST/${txid[i].txid}" target="_blank">more info</td>
                            </tr>
                        `;
                        }
                    }
                    else if (txid[i].confirmations > 0) {
                        if (catagory.includes('send')) {
                            table += `
                            <tr>
                                <td style="width: 30vw; overflow-x: scroll;">${txid[i].txid}</td>
                                <td>${catagory}</td>
                                <td>${txid[i].amount} Ð</td>
                                <td>${newTime}</td>
                                <td>${txid[i].confirmations}</td>
                                <td><button class="${txid[i].confirmations > 0 ? 'btn btn-success' : 'btn btn-warning'}" style="background: ${txid[i].confirmations > 0 ? 'limegreen' : '#ffc107'};">${txid[i].confirmations > 0 ? 'success' : 'pending'}</button></td>
                                <td><a href="https://chain.so/tx/DOGETEST/${txid[i].txid}" target="_blank">more info</td>
                            </tr>
                        `;
                        } else if (catagory.includes("receive")) {
                            table += `
                            <tr>
                                <td style="width: 30vw; overflow-x: scroll;">${txid[i].txid}</td>
                                <td>${catagory}</td>
                                <td>${txid[i].amount} Ð</td>
                                <td>${newTime}</td>
                                <td>${txid[i].confirmations}</td>
                                <td><button class="${txid[i].confirmations > 0 ? 'btn btn-success' : 'btn btn-warning'}" style="background: ${txid[i].confirmations > 0 ? 'limegreen' : '#ffc107'};">${txid[i].confirmations > 0 ? 'success' : 'pending'}</button></td>
                                <td><a href="https://chain.so/tx/DOGETEST/${txid[i].txid}" target="_blank">more info</td>
                            </tr>
                        `;
                        }
                    }

                }
                $('#tableProfile_total').html(table)
                // $('#tableProfile_success').append(success)
                // $('#tableProfile_pending').append(pending)
            })
        }
        else{
            $('#tableProfile_total').html(``)
        }
    });
    // $(function(){
    //     document.getElementById('tableProfile_total').style.display = '';
    // })

</script>