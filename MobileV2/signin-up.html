<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>sign in & sign up</title>
    <!-- bootstrap5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
        crossorigin="anonymous"></script>
    <!-- AJAX -->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <!-- axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- swal2 -->
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<!-- <link rel="stylesheet" href="./css/fontv2.css"> -->
<style>
    @font-face {
        font-family: 'mydogefont';
        src: url('./font/strawberry_muffins/Strawberry\ Muffins\ Demo.ttf');
    }

    .sg {
        margin-top: 1.5rem;
    }

    .input-img {
        width: 100%;
        height: 100%;

    }

    .input-s {
        width: 45vw;
        outline: none;
        border: none;
        background: none;
    }

    .input-s::placeholder {
        color: #fff;
        text-align: center;
    }

    .input-s:focus::placeholder {
        color: transparent;
    }

    img {
        width: 80%;
    }


    .sign_btn {
        background: #F8CF5F;
        border-radius: 16px;
        width: 80%;
    }

    .footerbg {
        background-color: #E9A700;
        height: 70vh;
        border-radius: 36px 36px 0 0;
        box-shadow: inset 0px 4px 4px rgba(0, 0, 0, 0.25);
        /* overflow-x: hidden;
        overflow-y: scroll; */
    }

    .line {
        border: 3px solid #956934;
        width: 40vw;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        left: 8.5vw;
        transition: 375ms;
    }

    .line_active {
        width: 40vw;
        left: 45vw;
    }

    .signin_detail {
        position: absolute;
        width: 100%;
        transition: all 250ms linear;
        left: 0;
    }

    .signup_detail {
        position: absolute;
        width: 100%;
        transition: all 250ms linear;
        right: -100vw;
    }

    .signin_active {
        left: -100vw;
    }

    .signup_active {
        right: 0;
    }

    /* Hide scrollbar for Chrome, Safari and Opera */
    .hideScrollBar::-webkit-scrollbar {
        display: none;
    }

    /* Hide scrollbar for IE, Edge and Firefox */
    .hideScrollBar {
        -ms-overflow-style: none;
        /* IE and Edge */
        scrollbar-width: none;
        /* Firefox */
    }



    /* The Modal (background) */
    .modal {
        display: none;
        /* Hidden by default */
        position: fixed;
        /* Stay in place */
        z-index: 1;
        /* Sit on top */
        padding-top: 100px;
        /* Location of the box */
        left: 0;
        top: 0;
        width: 100%;
        /* Full width */
        height: 100%;
        /* Full height */
        overflow: auto;
        /* Enable scroll if needed */
        background-color: rgb(0, 0, 0);
        /* Fallback color */
        background-color: rgba(0, 0, 0, 0.4);
        /* Black w/ opacity */
    }

    /* Modal Content */
    .modal-content {
        background-color: #E9A700;
        ;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 90%;
    }

    /* The Close Button */
    .close {
        color: #000;
        float: right;
        font-size: 28px;
        font-weight: bold;
        text-align: end;
    }

    .close:hover,
    .close:focus {
        color: #aaa;
        text-decoration: none;
        cursor: pointer;
    }


    .mne1 {
        position: absolute;
        padding: 5vh 0;
        width: 100%;
        transition: all 300ms linear;
        /* display: block; */
        bottom: 0vh;
    }

    .mne2 {
        position: absolute;
        padding: 5vh 0 5vh;
        width: 100%;
        transition: all 300ms linear;
        /* display: none; */
        top: 60vh;
    }

    .mne1Active {
        /* display: none; */
        bottom: 60vh;
    }

    .mne2Active {
        /* display: block; */
        top: 0vh;
    }
</style>



<body style="background-color: black;font-family:mydogefont;">

    <div class="container-fluid d-flex justify-content-center align-items-center flex-column"
        style="font-size: 3rem ; height: 30vh;">
        <span style="font-family:mydogefont;color: #E9A700;">
            Welcome
        </span>
        <span style="font-family:mydogefont;color: #E9A700; font-size: 1rem;"> moondoge dogecoin wallet apps</span>
    </div>
    <div id="container" class="container-fluid footerbg">
        <div class=" d-flex justify-content-around" style="font-size: 1.2rem ">
            <span id="signintab" class="sg">SIGN IN</span>
            <span id="signuptab" class="sg">SIGN UP</span>
        </div>
        <div class="position-relative mt-2">
            <div class="container-fluid d-flex justify-content-center">
                <div style="border: 1px solid #000000; width: 87%; margin-top: 4px; z-index: 1;"></div>
                <div id="animate_line" class="position-absolute line"></div>
            </div>
        </div>

        <div class="hideScrollBar"
            style="position: relative; width: 100%; height: 60vh; overflow-y: scroll; overflow-x: hidden;">

            <div id="signin_detail" class="signin_detail">
                <div class="d-flex justify-content-center mt-4 flex-column">
                    <div class="d-flex justify-content-center align-items-center flex-column"
                        style="position: relative;">
                        <img src="./img/Groupuserinput.png" alt="">
                        <input id="log_user" class="input-s" type="text" placeholder="username"
                            style="position:absolute; left: 35vw; text-align: center;">
                    </div>
                    <br>
                    <div class="d-flex justify-content-center align-items-center flex-column"
                        style="position: relative;">
                        <img src="./img/pass.png" alt="">
                        <input id="log_pwd" class="input-s" type="password" placeholder="password"
                            style="position:absolute;left: 35vw; text-align: center;">
                    </div>
                    <br>
                    <sign-in class="d-flex justify-content-center align-items-center">
                        <button id="login_btn" class="sign_btn d-flex justify-content-center align-items-center fs-4"
                            style="height: 8vh;">Sign in
                        </button>
                    </sign-in>
                    <br>
                    <div class="text-center mt-1">or</div>
                    <br>
                    <div id="MyBtn" onclick="mnemonicModal()" class="text-center text-decoration-underline">sign in with
                        mnemonic</div>
                </div>
            </div>

            <div id="signup_detail" class="signup_detail">
                <div class="d-flex justify-content mt-4 flex-column" style="height: 40%">
                    <div class="d-flex justify-content-center align-items-center flex-column"
                        style="position: relative;">
                        <img src="./img/Groupuserinput.png" alt="">

                        <input id="sign_user" class="input-s" type="text" placeholder="username"
                            style="position:absolute; left: 35vw; text-align: center;">
                    </div>
                    <br>
                    <div class="d-flex justify-content-center align-items-center flex-column"
                        style="position: relative;">
                        <img src="./img/pass.png" alt="">

                        <input id="sign_pwd" class="input-s" type="password" placeholder="password"
                            style="position:absolute;left: 35vw; text-align: center;">
                    </div>
                    <br>
                    <div class="d-flex justify-content-center align-items-center flex-column"
                        style="position: relative;">
                        <img src="./img/pass.png" alt="">

                        <input id="sign_pwdAg" class="input-s" type="password" placeholder="confirm password"
                            style="position:absolute;left: 35vw; text-align: center;">
                    </div>
                    <br>
                    <label style="text-align: center;">
                        <input type="checkbox" checked="checked">
                        agree to terms and conditions
                    </label>
                    <br>
                    <sign-up class="d-flex justify-content-center align-items-center">
                        <button id="sign_up" class="sign_btn d-flex justify-content-center align-items-center fs-4"
                            id="signupGo" onclick="signupGo()" style="height: 8vh; width: 80vw;">Sign up
                        </button>

                    </sign-up>
                </div>
            </div>

        </div>

    </div>


    <!-- Fill Mnemonic -->
    <div id="mnemonicModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div style="display: flex; flex-direction: column; text-align: center;">
                <span style="font-size: 2rem;">Your Recovery Phrase</span>
                <span>your recovery phrase gives you access to your wallet and all the private keys in the
                    wallet.</span>
                <div style="width: 100%; position: relative; height: 46vh; z-index: 2; overflow-y: hidden;">
                    <div id="mne1" class="mne1"></div>
                    <div id="mne2" class="mne2"></div>
                </div>

                <div id="mneNext"
                    style="display: flex; justify-content: space-between; font-size: 1.4rem; padding-top: 1vh;">
                    <button style="border-radius: 10vw; padding: 1vw 4vw; visibility: hidden;">Done</button>
                    <button id="mneNext1" onclick="MneNext()"
                        style="border-radius: 8vw; padding: 1vw 10vw; background-color: rgba(255, 255, 255, 0.4);">Next</button>
                    <button id="mneSuccess" onclick="checkMnemonic()"
                        style="border-radius: 10vw; padding: 1vw 4vw; background: #adff2f6b; transition-duration: 200ms;">Done</button>
                </div>
            </div>
        </div>
    </div>

    <!-- show Mnemonic -->
    <div id="showMnemonicModal" class="modal">
        <div class="modal-content">
            <!-- <span class="close">&times;</span> -->
            <span></span>
            <div style="display: flex; flex-direction: column; text-align: center;">
                <span style="font-size: 2rem;">Your Recovery Phrase</span>
                <span>your recovery phrase gives you access to your wallet and all the private keys in the
                    wallet.</span>
                <div style="width: 100%; position: relative; height: 46vh; z-index: 2; overflow-y: hidden;">
                    <div id="showMne1" class="mne1"></div>
                    <div id="showMne2" class="mne2"></div>
                </div>

                <div id="showMneNext"
                    style="display: flex; justify-content: space-between; font-size: 1.4rem; padding-top: 1vh;">
                    <button style="border-radius: 10vw; padding: 1vw 4vw; visibility: hidden;">Done</button>
                    <button id="showMneNext1" onclick="showMneNext()"
                        style="border-radius: 8vw; padding: 1vw 10vw; background-color: rgba(255, 255, 255, 0.4);">Next</button>
                    <button id="showMneSuccess" onclick="gotofillmnemonic()"
                        style="border-radius: 10vw; padding: 1vw 4vw; background: #adff2f6b; transition-duration: 200ms;">Done</button>
                </div>
            </div>
        </div>
    </div>


</body>

</html>
<!-- Login.js -->
<!-- <script src="./js/login.js"></script> -->
<!-- signup -->
<!-- <script src="./js/signup_bn.js"></script> -->
<!-- create wallet -->
<!-- <script src="./js/import-and-create.js"></script> -->
<script>
    var signin = document.getElementById('signintab');
    var signup = document.getElementById('signuptab');
    signin.onclick = function () {
        console.log("signin");
        $('.signin_detail').removeClass("signin_active");
        $('.signup_detail').removeClass("signup_active");
        document.querySelector('#animate_line').classList.remove("line_active");
    }
    signup.onclick = function () {
        console.log("signup");
        $('.signup_detail').addClass("signup_active");
        $('.signin_detail').addClass("signin_active");
        document.querySelector('#animate_line').classList.add("line_active");
    }




    // Get the modal
    var modal = $("#mnemonicModal");

    // Get the <span> element that closes the modal
    var span1 = document.getElementsByClassName("close")[0];
    var span2 = document.getElementsByClassName("close")[1];

    function mnemonicModal() {
        modal.css("display", "block");
        $("#mneSuccess").css("opacity", "0");
        // $(window).click(function(e) {
        //     console.log(e.target == modal);
        //     if (e.target == modal) {
        //         modal.css("display","none");
        //     }
        // });
    }

    // When the user clicks on <span> (x), close the modal
    span1.onclick = function () {
        modal.css("display", "none");
        console.log("close")
    }

    // span2.onclick = function () {
    //     console.log("close")
    //     $("#showMnemonicModal").css("display", "none");
    // }

    var checkNext = 1;
    var getMneObj = [];
    var showNext


    function MneNext() {
        var next = $("#mneNext1");
        var html = ``;
        console.log("หน้าปัจจุบัน:", checkNext);
        if (checkNext == 1 || checkNext == undefined) {
            checkNext = 2;
            console.log("หน้าถัดไป หน้าที่ :", checkNext);
            $("#mne1").addClass("mne1Active");
            $("#mne2").addClass("mne2Active");
            $("#mneSuccess").css("opacity", "1");
            next.html(`Back`)
        } else if (checkNext == 2) {
            checkNext = 1;
            console.log("กลับมา หน้าที่ :", checkNext);
            $("#mne1").removeClass("mne1Active");
            $("#mne2").removeClass("mne2Active");
            $("#mneSuccess").css("opacity", "0");
            next.html(`Next`)
        } else {
            checkNext = 1;
            console.log("เกิดปัญหา วิ่งไปที่หน้า", checkNext);
            alert("Error! Please fill mnemonic again");
            $("#mneSuccess").css("opacity", "0");
            next.html(`Next`)
        }
    }




    // signup

    var mnKeys;

    function signupGo() {
        axios('http://167.99.71.116:3000/api/get/register').then(res => {
            // console.log(res.data.Result);
            let data = res.data.Result
            let user = $('#sign_user').val();
            let pwd = $('#sign_pwd').val();
            let pwd_cf = $('#sign_pwdAg').val();
            // "(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z]).{8,}";
            let pattern = /^[0-9a-zA-Z]{8,}$/;
            if (pwd != pwd_cf) {
                console.log(pwd, " | ", pwd_cf)
                console.log('worng')
                // Swal2Alert(icon = 'error', title = 'Oops...', text = 'Password not match')
                Swal.fire({
                    title: 'Oops..., color',
                    text: 'Password not match',
                    imageUrl: './img/moon.png',
                    imageWidth: 200,
                    imageHeight: 200,
                    imageAlt: 'Custom image',
                })

            } else {
                console.log("user: ",user,user.match(pattern))

                if (user.match(pattern)) {
                    if(pwd.match(pattern) && pwd_cf.match(pattern)){
                        axios.post('http://167.99.71.116:3000/api/insert/register', {
                            username: user,
                            password: pwd
                        }).then(function (response) {
                            console.log(response.data);
                            let status = response.data.status
                            let result_title = response.data.Result
                            if (status == true) {

                                Swal.fire({ icon: 'success', text: result_title, title: 'Success' })
                                // document.getElementById('id_loading').style.display = 'flex'
                                setTimeout(signin.onclick, 1500)



                            } else {
                                Swal.fire({ icon: 'error', title: result_title, text: 'Plase try again' });
                            }

                        }).catch(function (error) {
                            console.log(error);
                            Swal.fire({ icon: 'error', title: 'Server catch!', text: 'Error' });
                        });
                    }
                    else{
                        Swal.fire({
                        title: 'Username incorrect !',
                        text: 'Please fill Alphabet and Numeric least 1! 8 characters or more!!',
                        imageUrl: './img/dogehead.png',
                        imageWidth: 200,
                        imageHeight: 200,
                        imageAlt: 'Custom image',
                    })
                    }
                }
                else {
                    // Swal2Alert('error', 'Error', 'Please fill all field')
                    Swal.fire({
                        title: 'Password incorrect !',
                        text: 'Please fill Alphabet and numeric least 1! 8 characters or more!!',
                        imageUrl: './img/dogehead.png',
                        imageWidth: 200,
                        imageHeight: 200,
                        imageAlt: 'Custom image',
                    })
                }

            }
        }).catch(err => {
            console.log(err);
        });
    }


    // show Mnemonic






    function mnemonicModal_Show() {
        $("#showMnemonicModal").css("display", "block");
        $("#showMneSuccess").css("opacity", "0");

    }

    $(function () {
        localStorage.clear()
        let putMnemonic1 = ``;
        let putMnemonic2 = ``;
        putMnemonic1 += `<div style="display: grid; grid-template-columns: repeat(2,1fr); gap: 2.5vw;">`;
        putMnemonic2 += `<div style="display: grid; grid-template-columns: repeat(2,1fr); gap: 2.5vw;">`;
        for (let i = 0; i < 12; i++) {
            putMnemonic1 += `
            <div
                                style="height: 10vw; border-radius: 50px; box-shadow: 1xp 1px 5px #000; display: flex; justify-content: center; align-items: center; background-color: rgba(255, 255, 255, 0.7);">
                                ${i + 1} <input id="chkMneKey${i+1}" type="text" style="width: 75%; border: none; background: none;outline: none; text-align: center;">
                            </div>
            `;
        }
        // chkMneKey${j}
        for (let j = 12; j < 24; j++) {
            putMnemonic2 += `
            <div
                                style="height: 10vw; border-radius: 50px; box-shadow: 1xp 1px 5px #000; display: flex; justify-content: center; align-items: center; background-color: rgba(255, 255, 255, 0.7);">
                                ${j + 1} <input id="chkMneKey${j+1}" type="text" style="width: 75%; border: none; background: none;outline: none; text-align: center;">
                            </div>
            `;
        }
        putMnemonic1 += `</div>`;
        putMnemonic2 += `</div>`;

        $("#mne1").append(putMnemonic1);
        $("#mne2").append(putMnemonic2);

    })


    function showMneNext() {

        var next = $("#showMneNext1");
        var html = ``;
        console.log("หน้าปัจจุบัน:", showNext);
        if (showNext == 1 || showNext == undefined) {
            showNext = 2;
            console.log("หน้าถัดไป หน้าที่ :", showNext);
            $("#showMne1").addClass("mne1Active");
            $("#showMne2").addClass("mne2Active");
            $("#showMneSuccess").css("opacity", "1");
            next.html(`Back`)
        } else if (showNext == 2) {
            showNext = 1;
            console.log("กลับมา หน้าที่ :", showNext);
            $("#showMne1").removeClass("mne1Active");
            $("#showMne2").removeClass("mne2Active");
            $("#showMneSuccess").css("opacity", "0");
            next.html(`Next`)
        } else {
            showNext = 1;
            console.log("เกิดปัญหา วิ่งไปที่หน้า", showNext);
            alert("Error! Please fill mnemonic again");
            $("#showMneSuccess").css("opacity", "0");
            next.html(`Next`)
        }
    }
    $(".showinputnext").keydown(function (event) {
        console.log()
        var next = $("#mneNext1");
        if (event.keyCode == 13 || event.keyCode == 9) {
            if (showNext == 1 || showNext == undefined) {
                showNext = 2;
                console.log("หน้าถัดไป หน้าที่ :", showNext);
                $("#mne1").addClass("mne1Active");
                $("#mne2").addClass("mne2Active");
                $("#mneSuccess").css("opacity", "1");
                next.html(`Back`)
            }
            event.preventDefault();
            return false;
        }
    });



    document.getElementById("login_btn").addEventListener("click", function () {
        let id_user = document.getElementById("log_user").value;
        let id_pwd = document.getElementById("log_pwd").value;
        if (!id_user || !id_pwd) {
            alert("Please fill in all the fields");
        }
        else {
            axios.post('http://167.99.71.116:3000/api/post/login', {
                username: id_user,
                password: id_pwd
            }).then((result) => {
                let data = result.data
                console.log(data)
                if (data.status == "success") {
                    localStorage.setItem('token', data.token),
                        localStorage.setItem('addr_count', data.addr_count),
                        Swal.fire({ icon: 'success', text: data.Result, title: 'success' })

                    if (data.addr_count == 0) {
                        startmnemonic();
                        setTimeout(mnemonicModal_Show(), 1000);
                    }
                    else {
                        window.location.href = "./main.html";
                    }


                }
                else {
                    Swal.fire({ icon: 'error', title: 'Wrong username or password' })
                    // alert("Wrong username or password");
                }

            }).catch((err) => {
                console.log(err)
                Swal.fire({ icon: 'error', text: 'server catch!!', title: 'error' })
            });
        }
    });

    var mnKeys;
    function startmnemonic() {
        axios.post('http://167.99.71.116:3000/api/post/create-wallet', {
            token: localStorage.getItem('token')
        }).then((result) => {
            let data = result.data.mnemonic;
            console.log(data, ":: typeof ::", typeof (data));
            mnKeys = data.split(' ');
            console.log(mnKeys)
            let txt1 = ``;
            let txt2 = ``;
            let keyLength = Object.keys(mnKeys);
            console.log('object :', typeof (mnKeys) == 'object' ? true : false, 'lenght :', keyLength.length);
            console.log('array :', typeof (mnKeys) == 'array' ? true : false, 'lenght :', mnKeys.lenght);


            txt1 += `<div style="display: grid; grid-template-columns: repeat(2,1fr); gap: 2.5vw;">`;
            txt2 += `<div style="display: grid; grid-template-columns: repeat(2,1fr); gap: 2.5vw;">`;

            for (let i = 0; i < keyLength.length / 2; i++) {
                txt1 += `<div style="height: 10vw; border-radius: 50px; box-shadow: 1xp 1px 5px #000; display: flex; justify-content: center; align-items: center; background-color: rgba(255, 255, 255, 0.7);">
                                ${i + 1}. <span id="shwMne${i+1}" type="text" style="width: 75%; border: none; background: none;outline: none;">${mnKeys[i]}</span></div>`;
            }
            for (let j = keyLength.length / 2; j < keyLength.length; j++) {
                txt2 += `<div style="height: 10vw; border-radius: 50px; box-shadow: 1xp 1px 5px #000; display: flex; justify-content: center; align-items: center; background-color: rgba(255, 255, 255, 0.7);">
                                ${j + 1}. <span id="shwMne${j+1}" type="text" style="width: 75%; border: none; background: none;outline: none;">${mnKeys[j]}</span></div>`;
            }
            txt1 += `</div>`;
            txt2 += `</div>`;
            $('#showMne1').append(txt1);
            $('#showMne2').append(txt2);
        }).catch((err) => {
            console.log('error create Mnemonic ====>', err)
        })

    }


    function gotofillmnemonic() {
        $("#showMnemonicModal").css("display", "none");
        mnemonicModal();
    }


    function checkMnemonic() {
        let chkMneKey = [];
        // console.log('type of(ตัวจริง) :',mnKeys)
        console.log('type of(สิ่งที่เขียน) :', chkMneKey)
        for (let i = 0; i < 24; i++) {
            chkMneKey.push($('#chkMneKey' + i).val());
        }

        if (!chkMneKey.includes('')) {
            var chkMneKey_txt = chkMneKey.join(' ')
            // var mnKeys_txt = mnKeys.join(' ')
            // if(chkMneKey_txt == mnKeys_txt){

            // console.log('txt     :',mnKeys_txt)
            console.log('checktxt:', chkMneKey_txt)

            axios.post('http://167.99.71.116:3000/api/login/mnemonic', {
                mnemonic: chkMneKey_txt,
            }).then((result) => {
                result = result.data;
                console.log("result ==>", result);
                localStorage.setItem("token", result.token);
                localStorage.setItem("addr_count", result.addr_count);
                if (result.status == 'success') {

                    swal.fire({
                        icon: 'success',
                        title: 'Success',
                        text: "Complete! Let's go Home."
                    });

                    setTimeout(() => { window.location.href = "./main.html"; }, 1500)

                }
                else {

                    swal.fire({
                        icon: 'warning',
                        title: 'Your input Wrong',
                    });

                }
            }).catch((err) => {
                swal.fire({
                    icon: 'warning',
                    title: 'Error',
                    text: err
                });
            })
            // }
            // else{
            //     swal.fire({
            //         icon: 'warning',
            //         title: 'Input wrong',
            //         text: "PLease try again."

            //     });
            // }
        }
        else {
            swal.fire({
                icon: 'warning',
                title: 'Input not fully',
                text: "PLease try again."

            });
        }

    }


</script>